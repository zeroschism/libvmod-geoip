varnishtest "Test geoip vmod"

server s1 {
        rxreq
	expect req.http.X-Geo-Country == "US"
	expect req.http.X-Geo-Latitude == "38.000"
	expect req.http.X-Geo-Latitude1 == "38"
	expect req.http.X-Geo-Longitude == "-97.000"
	expect req.http.X-Geo-Longitude1 == "-97"
	expect req.http.X-Geo-IP == "city  region  country US lat 38.000 lon -97.000 ip 2001:550:6600:0:e533:aeab:63fe:dd94"
        txresp
} -start

varnish v1 -vcl+backend {
        import geoip from "${vmod_topbuild}/src/.libs/libvmod_geoip.so";

        sub vcl_recv {
                geoip.set_headers_v6("2001:550:6600:0:e533:aeab:63fe:dd94");
        }
} -start

client c1 {
        txreq -url "/"
        rxresp
} -run

